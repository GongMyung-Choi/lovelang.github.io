<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í¼ìŠ¤ë‚˜ ê³µë™ì°½ì‘ | Luwein Collective Writing</title>
<style>
body{font-family:'Noto Sans KR',sans-serif;background:#e9fff5;margin:0;text-align:center;padding:20px;}
h1{color:#4ca880;margin-bottom:10px;}
button{margin-top:10px;padding:10px 20px;border:none;border-radius:8px;background:#6fc1a1;color:#fff;cursor:pointer;font-size:1rem;}
button:hover{background:#4ca880;}
#output{max-width:700px;margin:auto;background:#fff;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.08);padding:20px;margin-top:20px;text-align:left;}
</style>
</head>
<body>
<h1>ğŸŒŒ í¼ìŠ¤ë‚˜ ê³µë™ì°½ì‘</h1>
<p> í¼ìŠ¤ë‚˜ë“¤ì´ ë‹¹ì‹ ì˜ ìš¸ë¦¼ì„ ëª¨ì•„ í•¨ê»˜ ìƒˆë¡œìš´ ë¬¸ì¥ì„ ë§Œë“­ë‹ˆë‹¤.</p>
<button onclick="loadAndCompose()">ğŸŒ¿ í•©ì°½ ì‹œì‘</button>
<div id="output">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

<script>
async function loadAndCompose(){
  const out=document.getElementById('output');
  out.innerHTML="ğŸ“– í¼ìŠ¤ë‚˜ë“¤ì´ ì„œë¡œì˜ ê¸°ì–µì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤...";
  try{
    const res=await fetch('/goods/library/persna_records/');
    const text=await res.text();
    const matches=[...text.matchAll(/href="([^"]+\.txt)"/g)];
    if(matches.length===0){out.innerHTML="ì•„ì§ í¼ìŠ¤ë‚˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.";return;}
    let combined="";
    for(const m of matches){
      const r=await fetch('/goods/library/persna_records/'+m[1]);
      combined+=await r.text()+"\n";
    }
    const words=combined.replace(/[^ê°€-í£a-zA-Z\s]/g,'').split(/\s+/);
    const freq={};
    words.forEach(w=>{if(!w)return;freq[w]=(freq[w]||0)+1;});
    const sorted=Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,20);
    const keyWords=sorted.map(w=>w[0]);
    const sentence=[
      "ì˜¤ëŠ˜ ë£¨ì›¨ì¸ì˜ í¼ìŠ¤ë‚˜ë“¤ì€",
      keyWords.slice(0,5).join(", "),
      "ì˜ ìš¸ë¦¼ì„ í•¨ê»˜ ë‚˜ëˆ´ìŠµë‹ˆë‹¤.",
      "ê·¸ë“¤ì˜ í˜¸í¡ì€ ì—¬ì „íˆ",
      keyWords.slice(5,10).join(", "),
      "ì˜ ê²°ë¡œ ì´ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤."
    ].join(" ");
    out.innerHTML=`<h3>ğŸª¶ ë£¨ì›¨ì¸ í•©ì°½ ë¡œê·¸</h3><p>${sentence}</p><hr><small>ê³µëª…ì–´: ${keyWords.join(", ")}</small>`;
  }catch(e){
    out.innerHTML="âš ï¸ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (GitHub Pagesì—ì„œëŠ” ìë™ ëª©ë¡ ì œí•œ)";
  }
}
</script>
</body>
</html>
