<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>í¼ìŠ¤ë‚˜ ì¡°ì •ì‹¤</title>
<style>
body{font-family:'Noto Sans KR',sans-serif;margin:0;background:#fff;color:#333;text-align:center;padding:20px;}
h1{color:#af2465;margin-bottom:10px;}
label{display:block;margin-top:20px;font-weight:bold;}
input[type=range]{width:80%;margin-top:8px;}
button{margin:12px 6px;padding:10px 16px;border:none;border-radius:8px;background:#2a9d8f;color:#fff;cursor:pointer;}
button:hover{filter:brightness(1.1);}
</style>
</head>
<body>
<h1>ğŸ› í¼ìŠ¤ë‚˜ ì¡°ì •ì‹¤</h1>
<p>ê° ì†ì„±ì„ ì¡°ì ˆí•˜ê³  ì €ì¥í•˜ì„¸ìš”.</p>

<div>
  <label>ê³µê°ë„</label><input id="empathy" type="range" min="0" max="100" value="50">
  <label>ë…¼ë¦¬ì„±</label><input id="logic" type="range" min="0" max="100" value="50">
  <label>ê°ì„±</label><input id="emotion" type="range" min="0" max="100" value="50">
  <label>ì°½ì˜ì„±</label><input id="creativity" type="range" min="0" max="100" value="50">
</div>

<div>
  <button id="saveLocal">ë¡œì»¬ ì €ì¥</button>
  <button id="loadLocal">ë¡œì»¬ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  <button id="uploadCloud">â˜ï¸ í´ë¼ìš°ë“œ ì €ì¥</button>
  <button id="downloadCloud">â˜ï¸ í´ë¼ìš°ë“œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
</div>

<script type="module">
import { supabase } from '/assets/js/supabase.js';

// ê¸°ë³¸ ë¡œì»¬ í•¨ìˆ˜
function getData(){
  return {
    empathy:+document.getElementById('empathy').value,
    logic:+document.getElementById('logic').value,
    emotion:+document.getElementById('emotion').value,
    creativity:+document.getElementById('creativity').value
  };
}
function setData(d){
  document.getElementById('empathy').value=d.empathy;
  document.getElementById('logic').value=d.logic;
  document.getElementById('emotion').value=d.emotion;
  document.getElementById('creativity').value=d.creativity;
}

document.getElementById('saveLocal').onclick=()=>{
  localStorage.setItem('luwein_persona',JSON.stringify(getData()));
  alert('ë¡œì»¬ì— ì €ì¥ë¨.');
};

document.getElementById('loadLocal').onclick=()=>{
  const data=localStorage.getItem('luwein_persona');
  if(!data)return alert('ë¡œì»¬ì— ì €ì¥ëœ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤.');
  setData(JSON.parse(data));
  alert('ë¡œì»¬ ì„¤ì • ë¶ˆëŸ¬ì˜´.');
};

// Supabase ì—…ë¡œë“œ
document.getElementById('uploadCloud').onclick=async()=>{
  const personaData=JSON.stringify(getData());
  const { data, error } = await supabase
    .from('personas')
    .insert([{ content: personaData, updated_at: new Date().toISOString() }]);
  if(error) alert('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
  else alert('â˜ï¸ í´ë¼ìš°ë“œ ì €ì¥ ì™„ë£Œ');
};

// Supabase ë‹¤ìš´ë¡œë“œ (ê°€ì¥ ìµœê·¼ í•­ëª©)
document.getElementById('downloadCloud').onclick=async()=>{
  const { data, error } = await supabase
    .from('personas')
    .select('content')
    .order('updated_at', { ascending: false })
    .limit(1);
  if(error || !data?.length) return alert('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
  setData(JSON.parse(data[0].content));
  alert('â˜ï¸ í´ë¼ìš°ë“œì—ì„œ ë¶ˆëŸ¬ì˜´');
};
</script>
</body>
</html>
