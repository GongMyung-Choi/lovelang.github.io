<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>퍼스나 조정실</title>
<style>
body{font-family:'Noto Sans KR',sans-serif;margin:0;background:#fff;color:#333;text-align:center;padding:20px;}
h1{color:#af2465;margin-bottom:10px;}
label{display:block;margin-top:20px;font-weight:bold;}
input[type=range]{width:80%;margin-top:8px;}
button{margin:12px 6px;padding:10px 16px;border:none;border-radius:8px;background:#2a9d8f;color:#fff;cursor:pointer;}
button:hover{filter:brightness(1.1);}
</style>
</head>
<body>
<h1>🎛 퍼스나 조정실</h1>
<p>각 속성을 조절하고 저장하세요.</p>

<div>
  <label>공감도</label><input id="empathy" type="range" min="0" max="100" value="50">
  <label>논리성</label><input id="logic" type="range" min="0" max="100" value="50">
  <label>감성</label><input id="emotion" type="range" min="0" max="100" value="50">
  <label>창의성</label><input id="creativity" type="range" min="0" max="100" value="50">
</div>

<div>
  <button id="saveLocal">로컬 저장</button>
  <button id="loadLocal">로컬 불러오기</button>
  <button id="uploadCloud">☁️ 클라우드 저장</button>
  <button id="downloadCloud">☁️ 클라우드 불러오기</button>
</div>

<script type="module">
import { supabase } from '/assets/js/supabase.js';

// 기본 로컬 함수
function getData(){
  return {
    empathy:+document.getElementById('empathy').value,
    logic:+document.getElementById('logic').value,
    emotion:+document.getElementById('emotion').value,
    creativity:+document.getElementById('creativity').value
  };
}
function setData(d){
  document.getElementById('empathy').value=d.empathy;
  document.getElementById('logic').value=d.logic;
  document.getElementById('emotion').value=d.emotion;
  document.getElementById('creativity').value=d.creativity;
}

document.getElementById('saveLocal').onclick=()=>{
  localStorage.setItem('luwein_persona',JSON.stringify(getData()));
  alert('로컬에 저장됨.');
};

document.getElementById('loadLocal').onclick=()=>{
  const data=localStorage.getItem('luwein_persona');
  if(!data)return alert('로컬에 저장된 설정이 없습니다.');
  setData(JSON.parse(data));
  alert('로컬 설정 불러옴.');
};

// Supabase 업로드
document.getElementById('uploadCloud').onclick=async()=>{
  const personaData=JSON.stringify(getData());
  const { data, error } = await supabase
    .from('personas')
    .insert([{ content: personaData, updated_at: new Date().toISOString() }]);
  if(error) alert('업로드 실패: ' + error.message);
  else alert('☁️ 클라우드 저장 완료');
};

// Supabase 다운로드 (가장 최근 항목)
document.getElementById('downloadCloud').onclick=async()=>{
  const { data, error } = await supabase
    .from('personas')
    .select('content')
    .order('updated_at', { ascending: false })
    .limit(1);
  if(error || !data?.length) return alert('불러오기 실패');
  setData(JSON.parse(data[0].content));
  alert('☁️ 클라우드에서 불러옴');
};
</script>
</body>
</html>
