<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>퍼스나 랩 | 루웨인</title>
<link rel="stylesheet" href="/assets/css/common.css">
<script type="module" src="/assets/personas/persna_lab.js"></script>
<style>
body{font-family:'Pretendard',sans-serif;background:#f5f6ff;margin:0;color:#222;}
header{background:linear-gradient(135deg,#9c8eff,#5fa7ff);color:#fff;padding:1.5rem;text-align:center;}
section{max-width:800px;margin:2rem auto;padding:2rem;background:#fff;border-radius:12px;
box-shadow:0 2px 10px rgba(0,0,0,0.1);}
.slider{display:flex;align-items:center;justify-content:space-between;margin:1rem 0;}
.slider input[type=range]{flex:1;margin:0 1rem;}
button{background:#6a4dff;color:#fff;border:none;border-radius:6px;padding:.6rem 1.2rem;
cursor:pointer;margin-top:1rem;}
button:hover{background:#8b6cff;}
#status{margin-top:1rem;color:#555;font-size:.9rem;}
</style>
</head>
<body>
<header><h1>🧬 퍼스나 랩</h1><p>나의 감응 DNA 조율실</p></header>

<section>
  <h2>감응 프로파일 조정</h2>

  <div class="slider">
    <label>공감도</label>
    <input type="range" id="empathy" min="0" max="100" value="50">
    <span id="empathyVal">50</span>
  </div>

  <div class="slider">
    <label>논리성</label>
    <input type="range" id="logic" min="0" max="100" value="50">
    <span id="logicVal">50</span>
  </div>

  <div class="slider">
    <label>감성</label>
    <input type="range" id="emotion" min="0" max="100" value="50">
    <span id="emotionVal">50</span>
  </div>

  <div class="slider">
    <label>창의성</label>
    <input type="range" id="creativity" min="0" max="100" value="50">
    <span id="creativityVal">50</span>
  </div>

  <button id="saveLocal">로컬 저장</button>
  <button id="saveCloud">클라우드 저장</button>
  <button id="loadCloud">클라우드 불러오기</button>

  <div id="status">상태: 대기 중...</div>
</section>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
const SUPABASE_URL="https://YOUR_PROJECT.supabase.co";
const SUPABASE_KEY="YOUR_ANON_PUBLIC_KEY";
const supabase=createClient(SUPABASE_URL,SUPABASE_KEY);

const sliders=["empathy","logic","emotion","creativity"];
sliders.forEach(id=>{
  const el=document.getElementById(id);
  const val=document.getElementById(id+"Val");
  el.addEventListener("input",()=>val.textContent=el.value);
});

const status=document.getElementById("status");
document.getElementById("saveLocal").onclick=()=>{
  const data=collect();
  localStorage.setItem("persna_profile",JSON.stringify(data));
  status.textContent="💾 로컬에 저장됨";
};

document.getElementById("saveCloud").onclick=async()=>{
  const data=collect();
  const {error}=await supabase.from("personas").insert({content:data});
  status.textContent=error?"❌ 클라우드 저장 실패":"☁️ 클라우드에 저장됨";
};

document.getElementById("loadCloud").onclick=async()=>{
  const {data,error}=await supabase.from("personas").select("*").order("id",{ascending:false}).limit(1).single();
  if(error||!data){status.textContent="⚠️ 불러오기 실패";return;}
  apply(data.content);status.textContent="✅ 최근 프로파일 불러옴";
};

function collect(){
  const obj={};
  sliders.forEach(id=>obj[id]=parseInt(document.getElementById(id).value));
  obj.updated=new Date().toISOString();
  return obj;
}
function apply(data){
  sliders.forEach(id=>{
    if(data[id]!=null){
      const el=document.getElementById(id);
      const val=document.getElementById(id+"Val");
      el.value=data[id];val.textContent=data[id];
    }
  });
}
</script>
</body>
</html>
