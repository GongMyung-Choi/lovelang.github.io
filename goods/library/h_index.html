<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ë£¨ì›¨ì¸ ì „ìë„ì„œê´€ | ì¸ê°„ìš© ì¸ë±ìŠ¤</title>
<style>
body{font-family:'Noto Sans KR',sans-serif;background:#f8f8f8;margin:0;}
header{background:#3a655c;color:#fff;padding:18px;text-align:center;font-size:1.5rem;font-weight:700;}
main{max-width:1100px;margin:0 auto;padding:24px;}
.section{margin-bottom:40px;}
.section h2{color:#3a655c;border-left:6px solid #3a655c;padding-left:10px;margin-bottom:12px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px;}
.card{background:#fff;border-radius:12px;box-shadow:0 3px 6px rgba(0,0,0,0.12);padding:16px;}
.card h3{margin:0 0 6px;font-size:1.1rem;color:#2a9d8f;}
.badges{margin-top:4px;}
.badge{display:inline-block;background:#d9eee6;color:#333;padding:4px 8px;border-radius:6px;font-size:0.8rem;margin:2px;}
footer{text-align:center;padding:16px;color:#666;font-size:0.9rem;}
</style>
<!-- header.html ì˜ </head> ë°”ë¡œ ìœ„ìª½ì— ì¶”ê°€ -->
<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
<script type="module" src="/scripts/memory_policies.js" defer></script>

</head>
<body>
<header>ğŸ“š ë£¨ì›¨ì¸ ì „ìë„ì„œê´€ (ì¸ê°„ìš©)</header>
<main id="library"></main>
<footer>ë£¨ì›¨ì¸ ë””ì§€í„¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ Â© 2025</footer>

<script>
// ğŸ“˜ ë„ì„œ ëª©ë¡ (ìë™ ìƒì„± ì˜ˆì •)
const books = [
  './papers/h_101/summary.txt',
  './papers/h_205/summary.txt',
  './papers/h_301/summary.txt',
  './papers/h_403/summary.txt',
  './papers/h_601/summary.txt'
];

// ğŸ“˜ summary ë¶„ì„ í•¨ìˆ˜
async function parseSummary(path){
  const res = await fetch(path);
  const text = await res.text();
  const title = (text.match(/Title:\s*(.*)/i)||[])[1]||'ì œëª© ë¯¸ìƒ';
  const category = (text.match(/Category:\s*(.*)/i)||[])[1]||'ë¯¸ë¶„ë¥˜';
  const tagsLine = (text.match(/Tags:\s*(.*)/i)||[])[1]||'';
  const summary = (text.match(/Summary:\s*([\s\S]*)/i)||[])[1]||'';
  const tags = tagsLine.split(/[#,]/).map(t=>t.trim()).filter(Boolean);

  // ìë™ ê°ì‘ íƒœê·¸ ì¶”ê°€ (í‘œì‹œìš©, ë¶„ë¥˜ ì•„ë‹˜)
  const extra = [];
  const lower = summary.toLowerCase();
  if(/ì–¸ì–´|ë§|communication/.test(lower)) extra.push('ì–¸ì–´');
  if(/ì² í•™|ì¡´ì¬|ì˜ë¯¸|philosophy/.test(lower)) extra.push('ì² í•™');
  if(/ì˜ˆìˆ |art|ê°ì„±|ì°½ì˜/.test(lower)) extra.push('ì˜ˆìˆ ');
  if(/ê¸°ìˆ |ai|ì¸ê³µì§€ëŠ¥|system|tech/.test(lower)) extra.push('ê¸°ìˆ ');
  if(/ì¹˜ìœ |therapy|íšŒë³µ|healing/.test(lower)) extra.push('ì¹˜ìœ ');

  // íƒœê·¸ ì¤‘ë³µ ì œê±°
  const allTags = [...new Set([...tags, ...extra])];
  return { title, category, tags: allTags, summary };
}

// ğŸ“˜ ì¸ë±ìŠ¤ êµ¬ì¶• (ì¹´í…Œê³ ë¦¬ 1ê°œë§Œ)
async function buildLibrary(){
  const container = document.getElementById('library');
  const items = await Promise.all(books.map(parseSummary));
  const grouped = {};

  // í•œ ê¶Œë‹¹ ì¹´í…Œê³ ë¦¬ í•˜ë‚˜ë§Œ
  items.forEach(({title,category,tags,summary})=>{
    if(!grouped[category]) grouped[category]=[];
    grouped[category].push({title,tags,summary});
  });

  // ì¶œë ¥
  for(const cat in grouped){
    const section=document.createElement('section');
    section.className='section';
    section.innerHTML=`<h2>${cat}</h2><div class="grid"></div>`;
    const grid=section.querySelector('.grid');
    grouped[cat].forEach(({title,tags,summary})=>{
      const div=document.createElement('div');
      div.className='card';
      const badges=tags.map(t=>`<span class="badge">#${t}</span>`).join('');
      div.innerHTML=`<h3>${title}</h3><p>${summary.slice(0,100)}...</p><div class="badges">${badges}</div>`;
      grid.appendChild(div);
    });
    container.appendChild(section);
  }
}
buildLibrary();
</script>
</body>
</html>
