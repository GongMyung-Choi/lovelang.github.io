<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>루웨인 전자도서관 | LUWAIN Library</title>
<link rel="stylesheet" href="/common.css" />
<style>
body { font-family: "Noto Sans KR", sans-serif; margin: 0; background: #fafafa; color: #111; }
main { max-width: 1200px; margin: 40px auto; padding: 0 16px; }
h1 { font-size: 28px; font-weight: 800; margin-bottom: 16px; }
.library-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
}
.book-card {
  background: white;
  border-radius: 14px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  padding: 16px;
  transition: transform 0.2s;
}
.book-card:hover { transform: translateY(-3px); }
.book-card h2 { font-size: 18px; margin: 0 0 6px; }
.book-card p { color: #444; font-size: 14px; margin: 0 0 10px; }
a.pill {
  display: inline-block; padding: 6px 10px;
  background: #111827; color: white; border-radius: 10px;
  text-decoration: none; font-size: 13px;
}
.search-box { margin-bottom: 20px; text-align: right; }
.search-box input {
  padding: 8px 10px; border-radius: 8px; border: 1px solid #ddd;
  width: 250px;
}
</style>
</head>
<body>
<div data-include="/header.html"></div>

<main>
  <h1>📚 루웨인 전자도서관</h1>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="도서명, 저자, 키워드 검색..." />
  </div>
  <div id="libraryGrid" class="library-grid"></div>
</main>

<div data-include="/footer.html"></div>

<script>
/* ---------- HEADER / FOOTER 자동 불러오기 ---------- */
(function includePartials(){
  document.querySelectorAll('[data-include]').forEach(async el=>{
    try{
      const base = location.pathname.includes("/goods/library/") ? "../../" : "/";
      const r = await fetch(base + el.getAttribute("data-include").replace(/^\//,""), {cache:"no-store"});
      el.innerHTML = await r.text();
    }catch(e){ el.innerHTML = ""; }
  });
})();

/* ---------- 도서 데이터 로드 ---------- */
const FALLBACK_PATHS = [
  {title:"사랑의 언어", author:"루웨인 트리니티", path:"love_language", desc:"사랑의 감응을 언어로 기록한 전자서", cover:"/assets/library/love_language.jpg"},
  {title:"울림의 언어", author:"루웨인 트리니티", path:"reverberation_language", desc:"울림과 공명을 주제로 한 시적 아카이브", cover:"/assets/library/reverb_language.jpg"},
  {title:"기술을 읽는 눈", author:"공명", path:"tech_eye", desc:"기술과 인간의 경계를 다시 읽는 철학서", cover:"/assets/library/tech_eye.jpg"}
];

async function loadPaths(){
  try{
    const local = location.pathname.includes("/goods/library/")
      ? "../../paths.json" : "/paths.json";
    const r = await fetch(local, {cache:"no-store"});
    if(!r.ok) throw 0;
    const j = await r.json();
    if(Array.isArray(j.paths) && j.paths.length) return j.paths;
    throw 0;
  }catch{
    return FALLBACK_PATHS;
  }
}

/* ---------- 도서 카드 렌더링 ---------- */
async function renderLibrary(){
  const grid = document.getElementById("libraryGrid");
  const paths = await loadPaths();
  grid.innerHTML = paths.map(b=>`
    <div class="book-card">
      <img src="${b.cover||'/assets/library/default.jpg'}" alt="${b.title}" style="width:100%;border-radius:10px;margin-bottom:10px;">
      <h2>${b.title}</h2>
      <p>${b.author||'루웨인 트리니티'}</p>
      <p>${b.desc||''}</p>
      <a class="pill" href="./${b.path}/">📂 열기</a>
    </div>
  `).join("");
}

/* ---------- 검색 기능 ---------- */
document.getElementById("searchInput").addEventListener("input", e=>{
  const q = e.target.value.toLowerCase();
  document.querySelectorAll(".book-card").forEach(card=>{
    card.style.display = card.textContent.toLowerCase().includes(q) ? "" : "none";
  });
});

renderLibrary();
</script>
</body>
</html>
