<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë£¨ì›¨ì¸ ë„ì„œê´€ | ì¸ê°„ìš© ë„ì„œ</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div id="header-placeholder"></div>
  <script>
    fetch('/includes/header.html')
      .then(r=>r.text())
      .then(d=>document.getElementById('header-placeholder').innerHTML=d);

  </script><div style="text-align:center; margin-top:20px;">
  <input
    id="searchInput"
    type="text"
    placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì² í•™, ë£¨ì›¨ì¸)"
    style="padding:10px; width:60%; border-radius:8px; border:1px solid #ccc;"
  />
</div>

<div id="library" style="padding:20px;"></div>

<script>
async function loadLibrary() {
  try {
    const res = await fetch('metadata.json'); // âœ… ê²½ë¡œ ì •í™•íˆ ì¼ì¹˜
    if (!res.ok) throw new Error('metadata.json ë¡œë“œ ì‹¤íŒ¨');
    const data = await res.json();

    // ê·¸ë£¹í™”
    const grouped = {};
    data.forEach(book => {
      const category = book.category || 'ê¸°íƒ€';
      if (!grouped[category]) grouped[category] = [];
      grouped[category].push(book);
    });

    renderLibrary(grouped);

    // ğŸ” ê²€ìƒ‰ ê¸°ëŠ¥
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', e => {
      const keyword = e.target.value.trim().toLowerCase();
      const filtered = {};
      Object.entries(grouped).forEach(([cat, books]) => {
        const matches = books.filter(b =>
          b.title.toLowerCase().includes(keyword) ||
          (b.author && b.author.toLowerCase().includes(keyword))
        );
        if (matches.length) filtered[cat] = matches;
      });
      renderLibrary(filtered);
    });

  } catch (err) {
    console.error(err);
    document.getElementById('library').innerHTML =
      '<p style="color:red;">âš ï¸ ë©”íƒ€ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
  }
}

function renderLibrary(grouped) {
  const container = document.getElementById('library');
  container.innerHTML = '';

  Object.entries(grouped).forEach(([category, books]) => {
    const section = document.createElement('div');
    section.className = 'category';
    section.innerHTML = `
      <h2 style="margin-top:30px; color:#333;">ğŸ“š ${category}</h2>
      <ul style="list-style:none; padding-left:0;">
        ${books
          .map(
            b => `
            <li style="margin:8px 0;">
              <a href="${b.path}" style="text-decoration:none; color:#0077cc;">${b.title}</a>
              <span style="color:#666;"> â€” ${b.author || 'ìµëª…'}</span>
            </li>`
          )
          .join('')}
      </ul>`;
    container.appendChild(section);
  });
}

loadLibrary();
</script>

</script>

</body>
</html>
