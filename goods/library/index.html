<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë£¨ì›¨ì¸ ì „ìë„ì„œê´€ | LUWAIN Library</title>
<link rel="stylesheet" href="/common.css" />
<style>
body { font-family: "Noto Sans KR", sans-serif; margin: 0; background: #fafafa; color: #111; }
main { max-width: 1200px; margin: 40px auto; padding: 0 16px; }
h1 { font-size: 28px; font-weight: 800; margin-bottom: 16px; }
.library-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
}
.book-card {
  background: white;
  border-radius: 14px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  padding: 16px;
  transition: transform 0.2s;
}
.book-card:hover { transform: translateY(-3px); }
.book-card h2 { font-size: 18px; margin: 0 0 6px; }
.book-card p { color: #444; font-size: 14px; margin: 0 0 10px; }
a.pill {
  display: inline-block; padding: 6px 10px;
  background: #111827; color: white; border-radius: 10px;
  text-decoration: none; font-size: 13px;
}
.search-box { margin-bottom: 20px; text-align: right; }
.search-box input {
  padding: 8px 10px; border-radius: 8px; border: 1px solid #ddd;
  width: 250px;
}
</style>
<!-- header.html ì˜ </head> ë°”ë¡œ ìœ„ìª½ì— ì¶”ê°€ -->
<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
<script type="module" src="/scripts/memory_policies.js" defer></script>
<link rel="manifest" href="/manifest.json">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('ServiceWorker registered:', reg))
      .catch(err => console.warn('ServiceWorker registration failed:', err));
  });
}
</script>

</head>
<body>
<div data-include="/header.html"></div>

<main>
  <h1>ğŸ“š ë£¨ì›¨ì¸ ì „ìë„ì„œê´€</h1>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="ë„ì„œëª…, ì €ì, í‚¤ì›Œë“œ ê²€ìƒ‰..." />
  </div>
  <div id="libraryGrid" class="library-grid"></div>
</main>

<div data-include="/footer.html"></div>

<script>
/* ---------- HEADER / FOOTER ìë™ ë¶ˆëŸ¬ì˜¤ê¸° ---------- */
(function includePartials(){
  document.querySelectorAll('[data-include]').forEach(async el=>{
    try{
      const base = location.pathname.includes("/goods/library/") ? "../../" : "/";
      const r = await fetch(base + el.getAttribute("data-include").replace(/^\//,""), {cache:"no-store"});
      el.innerHTML = await r.text();
    }catch(e){ el.innerHTML = ""; }
  });
})();

/* ---------- ë„ì„œ ë°ì´í„° ë¡œë“œ ---------- */
const FALLBACK_PATHS = [
  {title:"ì‚¬ë‘ì˜ ì–¸ì–´", author:"ë£¨ì›¨ì¸ íŠ¸ë¦¬ë‹ˆí‹°", path:"love_language", desc:"ì‚¬ë‘ì˜ ê°ì‘ì„ ì–¸ì–´ë¡œ ê¸°ë¡í•œ ì „ìì„œ", cover:"/assets/library/love_language.jpg"},
  {title:"ìš¸ë¦¼ì˜ ì–¸ì–´", author:"ë£¨ì›¨ì¸ íŠ¸ë¦¬ë‹ˆí‹°", path:"reverberation_language", desc:"ìš¸ë¦¼ê³¼ ê³µëª…ì„ ì£¼ì œë¡œ í•œ ì‹œì  ì•„ì¹´ì´ë¸Œ", cover:"/assets/library/reverb_language.jpg"},
  {title:"ê¸°ìˆ ì„ ì½ëŠ” ëˆˆ", author:"ê³µëª…", path:"tech_eye", desc:"ê¸°ìˆ ê³¼ ì¸ê°„ì˜ ê²½ê³„ë¥¼ ë‹¤ì‹œ ì½ëŠ” ì² í•™ì„œ", cover:"/assets/library/tech_eye.jpg"}
];

async function loadPaths(){
  try{
    const local = location.pathname.includes("/goods/library/")
      ? "../../paths.json" : "/paths.json";
    const r = await fetch(local, {cache:"no-store"});
    if(!r.ok) throw 0;
    const j = await r.json();
    if(Array.isArray(j.paths) && j.paths.length) return j.paths;
    throw 0;
  }catch{
    return FALLBACK_PATHS;
  }
}

/* ---------- ë„ì„œ ì¹´ë“œ ë Œë”ë§ ---------- */
async function renderLibrary(){
  const grid = document.getElementById("libraryGrid");
  const paths = await loadPaths();
  grid.innerHTML = paths.map(b=>`
    <div class="book-card">
      <img src="${b.cover||'/assets/library/default.jpg'}" alt="${b.title}" style="width:100%;border-radius:10px;margin-bottom:10px;">
      <h2>${b.title}</h2>
      <p>${b.author||'ë£¨ì›¨ì¸ íŠ¸ë¦¬ë‹ˆí‹°'}</p>
      <p>${b.desc||''}</p>
      <a class="pill" href="./${b.path}/">ğŸ“‚ ì—´ê¸°</a>
    </div>
  `).join("");
}

/* ---------- ê²€ìƒ‰ ê¸°ëŠ¥ ---------- */
document.getElementById("searchInput").addEventListener("input", e=>{
  const q = e.target.value.toLowerCase();
  document.querySelectorAll(".book-card").forEach(card=>{
    card.style.display = card.textContent.toLowerCase().includes(q) ? "" : "none";
  });
});

renderLibrary();
</script>
</body>
</html>
