<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>루웨인 도서관 | 자동 인덱스</title>
<style>
body{font-family:'Pretendard',sans-serif;background:#f8f8fa;margin:0;color:#222;}
header{background:#4b2b52;color:#fff;text-align:center;padding:28px 0;}
h1{margin:0;font-size:2rem;}
h2{margin:0 0 10px;}
section{margin:40px auto;max-width:900px;padding:20px;background:#fff;
border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);}
ul{list-style:none;padding:0;}
li{margin:6px 0;}
a{color:#4b2b52;text-decoration:none;}
a:hover{text-decoration:underline;}
.error{color:#b00;font-size:.9em;}
footer{text-align:center;padding:20px;color:#555;}
</style>
</head>
<body>

<header>
  <h1>📚 루웨인 도서관 — 자동 인덱스 시스템</h1>
  <p>AI·인간 논문 및 책 자동 반영 + 링크 오류 탐지</p>
</header>

<div id="library"></div>

<footer>루웨인 자동 인덱스 시스템 β | 공명 설계</footer>

<script>
async function checkLink(url) {
  try {
    const res = await fetch(url, {method: 'HEAD'});
    return res.ok;
  } catch { return false; }
}

async function loadLibrary() {
  const base = './';
  const categories = {
    ai_papers: { title:'🤖 AI 논문', path:'papers/', filter:f=>!f.startsWith('h_') },
    h_papers: { title:'🧍 인간 논문', path:'papers/', filter:f=>f.startsWith('h_') },
    ai_books: { title:'📘 AI 책', path:'', filter:f=>f.endsWith('.html') && !f.startsWith('h_') && f!=='index.html' },
    h_books: { title:'📕 인간 책', path:'', filter:f=>f.startsWith('h_') },
    h_ebooks: { title:'📚 인간 전자책', path:'', filter:f=>f==='index.html' }
  };

  const container = document.getElementById('library');

  for (const key in categories) {
    const {title, path, filter} = categories[key];
    const section = document.createElement('section');
    section.innerHTML = `<h2>${title}</h2><ul id="${key}"></ul>`;
    container.appendChild(section);

    try {
      const res = await fetch(base + path);
      const text = await res.text();

      const parser = new DOMParser();
      const doc = parser.parseFromString(text, 'text/html');
      const links = Array.from(doc.querySelectorAll('a'))
        .map(a=>a.getAttribute('href'))
        .filter(h=>h && filter(h));

      for (const file of links) {
        const url = base + path + file;
        const ok = await checkLink(url);
        const li = document.createElement('li');
        li.innerHTML = ok
          ? `<a href="${url}" target="_blank">${file}</a>`
          : `<span class="error">⚠️ ${file} (링크 깨짐)</span>`;
        section.querySelector('ul').appendChild(li);
      }

    } catch {
      const li = document.createElement('li');
      li.textContent = '⚠️ 폴더를 불러오지 못했습니다.';
      section.querySelector('ul').appendChild(li);
    }
  }
}
loadLibrary();
</script>

</body>
</html>
